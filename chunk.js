import{L as B,a as r,b as T,c as be,r as h,j as o,d as ge,s as me,u as he,$ as A,e as pe,f as xe,g as Ce}from"./rich-editor-wc.js";var Q={},H={},_e=B,ee=r;let K=class ue extends ee.TextNode{static getType(){return"hashtag"}static clone(t){return new ue(t.__text,t.__key)}constructor(t,e){super(t,e)}createDOM(t){let e=super.createDOM(t);return _e.addClassNamesToElement(e,t.theme.hashtag),e}static importJSON(t){let e=te(t.text);return e.setFormat(t.format),e.setDetail(t.detail),e.setMode(t.mode),e.setStyle(t.style),e}exportJSON(){return{...super.exportJSON(),type:"hashtag"}}canInsertTextBefore(){return!1}isTextEntity(){return!0}};function te(u=""){return ee.$applyNodeReplacement(new K(u))}H.$createHashtagNode=te;H.$isHashtagNode=function(u){return u instanceof K};H.HashtagNode=K;const Ne=H;var Ee=Ne,ae={},Le=T,ve=be,we=B,Re=h;ae.useLexicalTextEntity=function(u,t,e){let[l]=Le.useLexicalComposerContext();Re.useEffect(()=>we.mergeRegister(...ve.registerLexicalTextEntity(l,u,t,e)),[e,l,u,t])};const ye=ae;var ze=ye,j=Ee,Me=T,$e=ze,W=h,Pe=RegExp;let D=String.fromCharCode,X="A-Za-zªµºÀ-ÖØ-öø-Ɂɐ-ˁˆ-ˑˠ-ˤˮͺΆΈ-ΊΌΎ-ΡΣ-ώϐ-ϵϷ-ҁҊ-ӎӐ-ӹԀ-ԏԱ-Ֆՙա-ևא-תװ-ײء-غـ-يٮ-ٯٱ-ۓەۥ-ۦۮ-ۯۺ-ۼۿܐܒ-ܯݍ-ݭހ-ޥޱऄ-हऽॐक़-ॡॽঅ-ঌএ-ঐও-নপ-রলশ-হঽৎড়-ঢ়য়-ৡৰ-ৱਅ-ਊਏ-ਐਓ-ਨਪ-ਰਲ-ਲ਼ਵ-ਸ਼ਸ-ਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલ-ળવ-હઽૐૠ-ૡଅ-ଌଏ-ଐଓ-ନପ-ରଲ-ଳଵ-ହଽଡ଼-ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கங-சஜஞ-டண-தந-பம-ஹఅ-ఌఎ-ఐఒ-నప-ళవ-హౠ-ౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠ-ೡഅ-ഌഎ-ഐഒ-നപ-ഹൠ-ൡඅ-ඖක-නඳ-රලව-ෆก-ะา-ำเ-ๆກ-ຂຄງ-ຈຊຍດ-ທນ-ຟມ-ຣລວສ-ຫອ-ະາ-ຳຽເ-ໄໆໜ-ໝༀཀ-ཇཉ-ཪྈ-ྋက-အဣ-ဧဩ-ဪၐ-ၕႠ-Ⴥა-ჺჼᄀ-ᅙᅟ-ᆢᆨ-ᇹሀ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙶᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦩᧁ-ᧇᨀ-ᨖᴀ-ᶿḀ-ẛẠ-ỹἀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₔℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℱℳ-ℹℼ-ℿⅅ-ⅉⰀ-Ⱞⰰ-ⱞⲀ-ⳤⴀ-ⴥⴰ-ⵥⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ々-〆〱-〵〻-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄬㄱ-ㆎㆠ-ㆷㇰ-ㇿ㐀-䶵一-龻ꀀ-ꒌꠀ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢ가-힣豈-鶴侮-頻並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּ-סּףּ-פּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ̀-ͯ҃-֑҆-ֹֻ-ֽֿׁ-ׂׄ-ׇׅؐ-ًؕ-ٰٞۖ-ۜ۟-ۤۧ-۪ۨ-ܑۭܰ-݊ަ-ްँ-ः़ा-्॑-॔ॢ-ॣঁ-ঃ়া-ৄে-ৈো-্ৗৢ-ৣਁ-ਃ਼ਾ-ੂੇ-ੈੋ-੍ੰ-ੱઁ-ઃ઼ા-ૅે-ૉો-્ૢ-ૣଁ-ଃ଼ା-ୃେ-ୈୋ-୍ୖ-ୗஂா-ூெ-ைொ-்ௗఁ-ఃా-ౄె-ైొ-్ౕ-ౖಂ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕ-ೖം-ഃാ-ൃെ-ൈൊ-്ൗං-ඃ්ා-ුූෘ-ෟෲ-ෳัิ-ฺ็-๎ັິ-ູົ-ຼ່-ໍ༘-༹༙༵༷༾-༿ཱ-྄྆-྇ྐ-ྗྙ-ྼ࿆ာ-ဲံ-္ၖ-ၙ፟ᜒ-᜔ᜲ-᜴ᝒ-ᝓᝲ-ᝳា-៓៝᠋-᠍ᢩᤠ-ᤫᤰ-᤻ᦰ-ᧀᧈ-ᧉᨗ-ᨛ᷀-᷃⃐-⃥⃜⃡-⃫〪-゙〯-゚ꠂ꠆ꠋꠣ-ꠧﬞ︀-️︠-︣À-ÖØ-öø-ÿĀ-ɏɓ-ɔɖ-ɗəɛɣɨɯɲʉʋʻ̀-ͯḀ-ỿЀ-ӿԀ-ԧⷠ-ⷿꙀ-֑ꚟ-ֿׁ-ׂׄ-ׇׅא-תװ-״﬒-ﬨשׁ-זּטּ-לּמּנּ-סּףּ-פּצּ-ﭏؐ-ؚؠ-ٟٮ-ۓە-ۜ۞-۪ۨ-ۯۺ-ۼۿݐ-ݿࢠࢢ-ࢬࣤ-ࣾﭐ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼ‌-‌ก-ฺเ-๎ᄀ-ᇿ㄰-ㆅꥠ-꥿가-힯ힰ-퟿ﾡ-ￜァ-ヺー-ヾｦ-ﾟ０-９Ａ-Ｚａ-ｚぁ-ゖ゙-ゞ㐀-䶿一-鿿"+(D(173824)+"-"+D(177983)+D(177984)+"-"+D(178207)+D(194560)+"-"+D(195103)+"〃々〻"),{alpha:Se,alphanumeric:re,hashChars:De}={alpha:X,alphanumeric:X+"0-9٠-٩۰-۹०-९০-৯੦-੯૦-૯୦-୯௦-௯౦-౯೦-೯൦-൯๐-๙໐-໙༠-༩၀-၉០-៩᠐-᠙᥆-᥏᧐-᧙０-９_",hashChars:"#\\uFF03"},q="["+re+"]",Oe=new Pe("(^|$|[^&/"+(re+"])([")+(De+"])(")+q+"*["+(Se+"]")+q+"*)","i");Q.HashtagPlugin=function(){let[u]=Me.useLexicalComposerContext();W.useEffect(()=>{if(!u.hasNodes([j.HashtagNode]))throw Error("HashtagPlugin: HashtagNode not registered on editor")},[u]);let t=W.useCallback(l=>j.$createHashtagNode(l.getTextContent()),[]),e=W.useCallback(l=>{if(l=Oe.exec(l),l===null)return null;const w=l.index+l[1].length;return{end:w+(l[3].length+1),start:w}},[]);return $e.useLexicalTextEntity(e,j.HashtagNode,t),null};const Ie=Q;var Te=Ie,se={},F={},ne=h;let U=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],J=U[Math.floor(Math.random()*U.length)],ce=ne.createContext({clientID:0,color:J[1],isCollabActive:!1,name:J[0],yjsDocMap:new Map});F.CollaborationContext=ce;F.useCollaborationContext=function(u,t){let e=ne.useContext(ce);return u!=null&&(e.name=u),t!=null&&(e.color=t),e};const He=F;var Ae=He,je=Ae,k=T,O=h;function We(u){let t=new URLSearchParams;t.append("code",u);for(let e=1;e<arguments.length;e++)t.append("v",arguments[e]);throw Error(`Minified Lexical error #${u}; visit https://lexical.dev/docs/error?${t} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}se.LexicalNestedComposer=function({initialEditor:u,children:t,initialNodes:e,initialTheme:l,skipCollabChecks:w}){let R=O.useRef(!1),E=O.useContext(k.LexicalComposerContext);E==null&&We(9);let[C,{getTheme:p}]=E,P=O.useMemo(()=>{var x=l||p()||void 0;const M=k.createLexicalComposerContext(E,x);if(x!==void 0&&(u._config.theme=x),u._parentEditor=C,e)for(var g of e)x=g.getType(),u._nodes.set(x,{klass:g,replace:null,replaceWithKlass:null,transforms:new Set});else{g=u._nodes=new Map(C._nodes);for(const[$,n]of g)u._nodes.set($,{klass:n.klass,replace:n.replace,replaceWithKlass:n.replaceWithKlass,transforms:new Set})}return u._config.namespace=C._config.namespace,u._editable=C._editable,[u,M]},[]),{isCollabActive:y,yjsDocMap:z}=je.useCollaborationContext(),_=w||R.current||z.has(u.getKey());return O.useEffect(()=>{_&&(R.current=!0)},[_]),O.useEffect(()=>C.registerEditableListener(x=>{u.setEditable(x)}),[u,C]),O.createElement(k.LexicalComposerContext.Provider,{value:P},!y||_?t:null)};const ke=se;var Ye=ke;function Be({className:u}){return o.jsx(ge.ContentEditable,{className:u||"ContentEditable__root"})}function Y(u,t,e){return Math.min(Math.max(u,t),e)}const c={east:1,north:8,south:2,west:4};function Ke({onResizeStart:u,onResizeEnd:t,imageRef:e,maxWidth:l,editor:w}){const R=h.useRef(null),E=h.useRef({priority:"",value:"default"}),C=h.useRef({currentHeight:0,currentWidth:0,direction:0,isResizing:!1,ratio:0,startHeight:0,startWidth:0,startX:0,startY:0}),p=w.getRootElement(),P=l||(p!==null?p.getBoundingClientRect().width-20:100),y=p!==null?p.getBoundingClientRect().height-20:100,z=100,_=100,x=a=>{const i=a===c.east||a===c.west,s=a===c.north||a===c.south,L=a&c.north&&a&c.west||a&c.south&&a&c.east,N=i?"ew":s?"ns":L?"nwse":"nesw";p!==null&&p.style.setProperty("cursor",`${N}-resize`,"important"),document.body!==null&&(document.body.style.setProperty("cursor",`${N}-resize`,"important"),E.current.value=document.body.style.getPropertyValue("-webkit-user-select"),E.current.priority=document.body.style.getPropertyPriority("-webkit-user-select"),document.body.style.setProperty("-webkit-user-select","none","important"))},M=()=>{p!==null&&p.style.setProperty("cursor","text"),document.body!==null&&(document.body.style.setProperty("cursor","default"),document.body.style.setProperty("-webkit-user-select",E.current.value,E.current.priority))},g=(a,i)=>{if(!w.isEditable())return;const s=e.current,L=R.current;if(s!==null&&L!==null){a.preventDefault();const{width:N,height:d}=s.getBoundingClientRect(),f=C.current;f.startWidth=N,f.startHeight=d,f.ratio=N/d,f.currentWidth=N,f.currentHeight=d,f.startX=a.clientX,f.startY=a.clientY,f.isResizing=!0,f.direction=i,x(i),u(),L.classList.add("image-control-wrapper--resizing"),s.style.height=`${d}px`,s.style.width=`${N}px`,document.addEventListener("pointermove",$),document.addEventListener("pointerup",n)}},$=a=>{const i=e.current,s=C.current,L=s.direction&(c.east|c.west),N=s.direction&(c.south|c.north);if(i!==null&&s.isResizing)if(L&&N){let d=Math.floor(s.startX-a.clientX);d=s.direction&c.east?-d:d;const f=Y(s.startWidth+d,z,P),S=f/s.ratio;i.style.width=`${f}px`,i.style.height=`${S}px`,s.currentHeight=S,s.currentWidth=f}else if(N){let d=Math.floor(s.startY-a.clientY);d=s.direction&c.south?-d:d;const f=Y(s.startHeight+d,_,y);i.style.height=`${f}px`,s.currentHeight=f}else{let d=Math.floor(s.startX-a.clientX);d=s.direction&c.east?-d:d;const f=Y(s.startWidth+d,z,P);i.style.width=`${f}px`,s.currentWidth=f}},n=()=>{const a=e.current,i=C.current,s=R.current;if(a!==null&&s!==null&&i.isResizing){const L=i.currentWidth,N=i.currentHeight;i.startWidth=0,i.startHeight=0,i.ratio=0,i.startX=0,i.startY=0,i.currentWidth=0,i.currentHeight=0,i.isResizing=!1,s.classList.remove("image-control-wrapper--resizing"),M(),t(L,N),document.removeEventListener("pointermove",$),document.removeEventListener("pointerup",n)}};return o.jsxs(Fe,{ref:R,children:[o.jsx("div",{className:"image-resizer image-resizer-n",onPointerDown:a=>{g(a,c.north)}}),o.jsx("div",{className:"image-resizer image-resizer-ne",onPointerDown:a=>{g(a,c.north|c.east)}}),o.jsx("div",{className:"image-resizer image-resizer-e",onPointerDown:a=>{g(a,c.east)}}),o.jsx("div",{className:"image-resizer image-resizer-se",onPointerDown:a=>{g(a,c.south|c.east)}}),o.jsx("div",{className:"image-resizer image-resizer-s",onPointerDown:a=>{g(a,c.south)}}),o.jsx("div",{className:"image-resizer image-resizer-sw",onPointerDown:a=>{g(a,c.south|c.west)}}),o.jsx("div",{className:"image-resizer image-resizer-w",onPointerDown:a=>{g(a,c.west)}}),o.jsx("div",{className:"image-resizer image-resizer-nw",onPointerDown:a=>{g(a,c.north|c.west)}})]})}const Fe=me.div`
  cursor: default;
  .image-resizer {
    display: block;
    width: 7px;
    height: 7px;
    position: absolute;
    background-color: rgb(60, 132, 244);
    border: 1px solid #fff;
  }

  .image-resizer.image-resizer-n {
    top: -6px;
    left: 48%;
    cursor: n-resize;
  }

  .image-resizer.image-resizer-ne {
    top: -6px;
    right: -6px;
    cursor: ne-resize;
  }

  .image-resizer.image-resizer-e {
    bottom: 48%;
    right: -6px;
    cursor: e-resize;
  }

  .image-resizer.image-resizer-se {
    bottom: -2px;
    right: -6px;
    cursor: nwse-resize;
  }

  .image-resizer.image-resizer-s {
    bottom: -2px;
    left: 48%;
    cursor: s-resize;
  }

  .image-resizer.image-resizer-sw {
    bottom: -2px;
    left: -6px;
    cursor: sw-resize;
  }

  .image-resizer.image-resizer-w {
    bottom: 48%;
    left: -6px;
    cursor: w-resize;
  }

  .image-resizer.image-resizer-nw {
    top: -6px;
    left: -6px;
    cursor: nw-resize;
  }
`;function Ge({children:u,className:t}){return o.jsx("div",{className:t||"Placeholder__root",children:u})}const V=new Set,Z=r.createCommand("RIGHT_CLICK_IMAGE_COMMAND");function Xe(u){if(!V.has(u))throw new Promise(t=>{const e=new Image;e.src=u,e.onload=()=>{V.add(u),t(null)}})}function qe({altText:u,className:t,imageRef:e,src:l,width:w,height:R,maxWidth:E}){return Xe(l),o.jsx("img",{className:t||void 0,src:l,alt:u,ref:e,style:{height:R,maxWidth:E,width:w},draggable:"false"})}function Je({src:u,altText:t,nodeKey:e,width:l,height:w,maxWidth:R,resizable:E,showCaption:C,caption:p,captionsEnabled:P}){const y=h.useRef(null),z=h.useRef(null),[_,x,M]=he.useLexicalNodeSelection(e),[g,$]=h.useState(!1),[n]=T.useLexicalComposerContext(),[a,i]=h.useState(null),s=h.useRef(null),L=h.useCallback(m=>{if(_&&r.$isNodeSelection(r.$getSelection())){m.preventDefault();const v=r.$getNodeByKey(e);A(v)&&v.remove()}return!1},[_,e]),N=h.useCallback(m=>{const b=r.$getSelection(),v=z.current;if(_&&r.$isNodeSelection(b)&&b.getNodes().length===1){if(C)return r.$setSelection(null),m.preventDefault(),p.focus(),!0;if(v!==null&&v!==document.activeElement)return m.preventDefault(),v.focus(),!0}return!1},[p,_,C]),d=h.useCallback(m=>s.current===p||z.current===m.target?(r.$setSelection(null),n.update(()=>{x(!0);const b=n.getRootElement();b!==null&&b.focus()}),!0):!1,[p,n,x]),f=h.useCallback(m=>{const b=m;return g?!0:b.target===y.current?(b.shiftKey?x(!_):(M(),x(!0)),!0):!1},[g,_,x,M]),S=h.useCallback(m=>{n.getEditorState().read(()=>{const b=r.$getSelection();m.target.tagName==="IMG"&&r.$isRangeSelection(b)&&b.getNodes().length===1&&n.dispatchCommand(Z,m)})},[n]);h.useEffect(()=>{let m=!0;const b=n.getRootElement(),v=B.mergeRegister(n.registerUpdateListener(({editorState:I})=>{m&&i(I.read(()=>r.$getSelection()))}),n.registerCommand(r.SELECTION_CHANGE_COMMAND,(I,le)=>(s.current=le,!1),r.COMMAND_PRIORITY_LOW),n.registerCommand(r.CLICK_COMMAND,f,r.COMMAND_PRIORITY_LOW),n.registerCommand(Z,f,r.COMMAND_PRIORITY_LOW),n.registerCommand(r.DRAGSTART_COMMAND,I=>I.target===y.current?(I.preventDefault(),!0):!1,r.COMMAND_PRIORITY_LOW),n.registerCommand(r.KEY_DELETE_COMMAND,L,r.COMMAND_PRIORITY_LOW),n.registerCommand(r.KEY_BACKSPACE_COMMAND,L,r.COMMAND_PRIORITY_LOW),n.registerCommand(r.KEY_ENTER_COMMAND,N,r.COMMAND_PRIORITY_LOW),n.registerCommand(r.KEY_ESCAPE_COMMAND,d,r.COMMAND_PRIORITY_LOW));return b==null||b.addEventListener("contextmenu",S),()=>{m=!1,v(),b==null||b.removeEventListener("contextmenu",S)}},[M,n,g,_,e,L,N,d,f,S,x]);const oe=()=>{n.update(()=>{const m=r.$getNodeByKey(e);A(m)&&m.setShowCaption(!0)})},ie=(m,b)=>{setTimeout(()=>{$(!1)},200),n.update(()=>{const v=r.$getNodeByKey(e);A(v)&&v.setWidthAndHeight(m,b)})},fe=()=>{$(!0)},de=_&&r.$isNodeSelection(a)&&!g,G=_||g;return o.jsx(h.Suspense,{fallback:null,children:o.jsxs(o.Fragment,{children:[o.jsx("div",{draggable:de,children:o.jsx(qe,{className:G?`focused ${r.$isNodeSelection(a)?"draggable":""}`:null,src:u,altText:t,imageRef:y,width:l,height:w,maxWidth:R})}),C&&o.jsx("div",{className:"image-caption-container",children:o.jsxs(Ye.LexicalNestedComposer,{initialEditor:p,children:[o.jsx(pe.AutoFocusPlugin,{}),o.jsx(Te.HashtagPlugin,{}),o.jsx(xe.RichTextPlugin,{contentEditable:o.jsx(Be,{className:"ImageNode__contentEditable"}),placeholder:o.jsx(Ge,{className:"ImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:Ce})]})}),E&&r.$isNodeSelection(a)&&G&&o.jsx(Ke,{showCaption:C,setShowCaption:oe,editor:n,buttonRef:z,imageRef:y,maxWidth:R,onResizeStart:fe,onResizeEnd:ie,captionsEnabled:P})]})})}export{Z as RIGHT_CLICK_IMAGE_COMMAND,Je as default};
