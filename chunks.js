import{L as B,a as n,b as T,c as ce,r as m,j as i,d as oe,E as ie,$ as Y,u as fe,e as de,f as le,g as be,h as ge}from"./rich-editor-wc.js";var Z={},A={},me=B,Q=n;let K=class ee extends Q.TextNode{static getType(){return"hashtag"}static clone(a){return new ee(a.__text,a.__key)}constructor(a,t){super(a,t)}createDOM(a){let t=super.createDOM(a);return me.addClassNamesToElement(t,a.theme.hashtag),t}static importJSON(a){let t=ue(a.text);return t.setFormat(a.format),t.setDetail(a.detail),t.setMode(a.mode),t.setStyle(a.style),t}exportJSON(){return{...super.exportJSON(),type:"hashtag"}}canInsertTextBefore(){return!1}isTextEntity(){return!0}};function ue(e=""){return Q.$applyNodeReplacement(new K(e))}A.$createHashtagNode=ue;A.$isHashtagNode=function(e){return e instanceof K};A.HashtagNode=K;const he=A;var pe=he,te={},xe=T,Ce=ce,Ee=B,_e=m;te.useLexicalTextEntity=function(e,a,t){let[l]=xe.useLexicalComposerContext();_e.useEffect(()=>Ee.mergeRegister(...Ce.registerLexicalTextEntity(l,e,a,t)),[t,l,e,a])};const Ne=te;var ve=Ne,H=pe,we=T,Le=ve,W=m,Me=RegExp;let O=String.fromCharCode,G="A-Za-zªµºÀ-ÖØ-öø-Ɂɐ-ˁˆ-ˑˠ-ˤˮͺΆΈ-ΊΌΎ-ΡΣ-ώϐ-ϵϷ-ҁҊ-ӎӐ-ӹԀ-ԏԱ-Ֆՙա-ևא-תװ-ײء-غـ-يٮ-ٯٱ-ۓەۥ-ۦۮ-ۯۺ-ۼۿܐܒ-ܯݍ-ݭހ-ޥޱऄ-हऽॐक़-ॡॽঅ-ঌএ-ঐও-নপ-রলশ-হঽৎড়-ঢ়য়-ৡৰ-ৱਅ-ਊਏ-ਐਓ-ਨਪ-ਰਲ-ਲ਼ਵ-ਸ਼ਸ-ਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલ-ળવ-હઽૐૠ-ૡଅ-ଌଏ-ଐଓ-ନପ-ରଲ-ଳଵ-ହଽଡ଼-ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கங-சஜஞ-டண-தந-பம-ஹఅ-ఌఎ-ఐఒ-నప-ళవ-హౠ-ౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠ-ೡഅ-ഌഎ-ഐഒ-നപ-ഹൠ-ൡඅ-ඖක-නඳ-රලව-ෆก-ะา-ำเ-ๆກ-ຂຄງ-ຈຊຍດ-ທນ-ຟມ-ຣລວສ-ຫອ-ະາ-ຳຽເ-ໄໆໜ-ໝༀཀ-ཇཉ-ཪྈ-ྋက-အဣ-ဧဩ-ဪၐ-ၕႠ-Ⴥა-ჺჼᄀ-ᅙᅟ-ᆢᆨ-ᇹሀ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙶᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦩᧁ-ᧇᨀ-ᨖᴀ-ᶿḀ-ẛẠ-ỹἀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₔℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℱℳ-ℹℼ-ℿⅅ-ⅉⰀ-Ⱞⰰ-ⱞⲀ-ⳤⴀ-ⴥⴰ-ⵥⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ々-〆〱-〵〻-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄬㄱ-ㆎㆠ-ㆷㇰ-ㇿ㐀-䶵一-龻ꀀ-ꒌꠀ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢ가-힣豈-鶴侮-頻並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּ-סּףּ-פּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ̀-ͯ҃-֑҆-ֹֻ-ֽֿׁ-ׂׄ-ׇׅؐ-ًؕ-ٰٞۖ-ۜ۟-ۤۧ-۪ۨ-ܑۭܰ-݊ަ-ްँ-ः़ा-्॑-॔ॢ-ॣঁ-ঃ়া-ৄে-ৈো-্ৗৢ-ৣਁ-ਃ਼ਾ-ੂੇ-ੈੋ-੍ੰ-ੱઁ-ઃ઼ા-ૅે-ૉો-્ૢ-ૣଁ-ଃ଼ା-ୃେ-ୈୋ-୍ୖ-ୗஂா-ூெ-ைொ-்ௗఁ-ఃా-ౄె-ైొ-్ౕ-ౖಂ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕ-ೖം-ഃാ-ൃെ-ൈൊ-്ൗං-ඃ්ා-ුූෘ-ෟෲ-ෳัิ-ฺ็-๎ັິ-ູົ-ຼ່-ໍ༘-༹༙༵༷༾-༿ཱ-྄྆-྇ྐ-ྗྙ-ྼ࿆ာ-ဲံ-္ၖ-ၙ፟ᜒ-᜔ᜲ-᜴ᝒ-ᝓᝲ-ᝳា-៓៝᠋-᠍ᢩᤠ-ᤫᤰ-᤻ᦰ-ᧀᧈ-ᧉᨗ-ᨛ᷀-᷃⃐-⃥⃜⃡-⃫〪-゙〯-゚ꠂ꠆ꠋꠣ-ꠧﬞ︀-️︠-︣À-ÖØ-öø-ÿĀ-ɏɓ-ɔɖ-ɗəɛɣɨɯɲʉʋʻ̀-ͯḀ-ỿЀ-ӿԀ-ԧⷠ-ⷿꙀ-֑ꚟ-ֿׁ-ׂׄ-ׇׅא-תװ-״﬒-ﬨשׁ-זּטּ-לּמּנּ-סּףּ-פּצּ-ﭏؐ-ؚؠ-ٟٮ-ۓە-ۜ۞-۪ۨ-ۯۺ-ۼۿݐ-ݿࢠࢢ-ࢬࣤ-ࣾﭐ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼ‌-‌ก-ฺเ-๎ᄀ-ᇿ㄰-ㆅꥠ-꥿가-힯ힰ-퟿ﾡ-ￜァ-ヺー-ヾｦ-ﾟ０-９Ａ-Ｚａ-ｚぁ-ゖ゙-ゞ㐀-䶿一-鿿"+(O(173824)+"-"+O(177983)+O(177984)+"-"+O(178207)+O(194560)+"-"+O(195103)+"〃々〻"),{alpha:ye,alphanumeric:ae,hashChars:Re}={alpha:G,alphanumeric:G+"0-9٠-٩۰-۹०-९০-৯੦-੯૦-૯୦-୯௦-௯౦-౯೦-೯൦-൯๐-๙໐-໙༠-༩၀-၉០-៩᠐-᠙᥆-᥏᧐-᧙０-９_",hashChars:"#\\uFF03"},X="["+ae+"]",ze=new Me("(^|$|[^&/"+(ae+"])([")+(Re+"])(")+X+"*["+(ye+"]")+X+"*)","i");Z.HashtagPlugin=function(){let[e]=we.useLexicalComposerContext();W.useEffect(()=>{if(!e.hasNodes([H.HashtagNode]))throw Error("HashtagPlugin: HashtagNode not registered on editor")},[e]);let a=W.useCallback(l=>H.$createHashtagNode(l.getTextContent()),[]),t=W.useCallback(l=>{if(l=ze.exec(l),l===null)return null;const w=l.index+l[1].length;return{end:w+(l[3].length+1),start:w}},[]);return Le.useLexicalTextEntity(t,H.HashtagNode,a),null};const De=Z;var Pe=De,re={},F={},ne=m;let U=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],q=U[Math.floor(Math.random()*U.length)],se=ne.createContext({clientID:0,color:q[1],isCollabActive:!1,name:q[0],yjsDocMap:new Map});F.CollaborationContext=se;F.useCollaborationContext=function(e,a){let t=ne.useContext(se);return e!=null&&(t.name=e),a!=null&&(t.color=a),t};const $e=F;var Se=$e,Oe=Se,j=T,I=m;function Ie(e){let a=new URLSearchParams;a.append("code",e);for(let t=1;t<arguments.length;t++)a.append("v",arguments[t]);throw Error(`Minified Lexical error #${e}; visit https://lexical.dev/docs/error?${a} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}re.LexicalNestedComposer=function({initialEditor:e,children:a,initialNodes:t,initialTheme:l,skipCollabChecks:w}){let _=I.useRef(!1),L=I.useContext(j.LexicalComposerContext);L==null&&Ie(9);let[M,{getTheme:x}]=L,C=I.useMemo(()=>{var s=l||x()||void 0;const $=j.createLexicalComposerContext(L,s);if(s!==void 0&&(e._config.theme=s),e._parentEditor=M,t)for(var h of t){var N=s=null;typeof h!="function"&&(N=h,h=N.replace,s=N.with,N=N.withKlass||null);const R=e._nodes.get(h.getType());e._nodes.set(h.getType(),{exportDOM:R?R.exportDOM:void 0,klass:h,replace:s,replaceWithKlass:N,transforms:new Set})}else{h=e._nodes=new Map(M._nodes);for(const[R,u]of h)e._nodes.set(R,{exportDOM:u.exportDOM,klass:u.klass,replace:u.replace,replaceWithKlass:u.replaceWithKlass,transforms:new Set})}return e._config.namespace=M._config.namespace,e._editable=M._editable,[e,$]},[]),{isCollabActive:E,yjsDocMap:y}=Oe.useCollaborationContext(),z=w||_.current||y.has(e.getKey());return I.useEffect(()=>{z&&(_.current=!0)},[z]),I.useEffect(()=>M.registerEditableListener(s=>{e.setEditable(s)}),[e,M]),I.createElement(j.LexicalComposerContext.Provider,{value:C},!E||z?a:null)};const Te=re;var Ae=Te;function He({className:e}){return i.jsx(oe.ContentEditable,{className:e||"ContentEditable__root"})}function k(e,a,t){return Math.min(Math.max(e,a),t)}const o={east:1,north:8,south:2,west:4};function We({imageRef:e,editor:a,nodeKey:t}){const l=m.useRef(null),w=m.useRef({priority:"",value:"default"}),_=m.useRef({currentHeight:100,currentWidth:100,direction:0,ratio:0,startHeight:0,startWidth:0,startX:0,startY:0}),[L,M]=m.useState(0),x=a.getRootElement(),C=x!==null?x.getBoundingClientRect().width-2*ie:100,E=x!==null?x.getBoundingClientRect().height:100,y=100,z=100,s=u=>{const g=u===o.east||u===o.west,b=u===o.north||u===o.south,c=u&o.north&&u&o.west||u&o.south&&u&o.east,v=g?"ew":b?"ns":c?"nwse":"nesw";x!==null&&x.style.setProperty("cursor",`${v}-resize`,"important"),document.body!==null&&(document.body.style.setProperty("cursor",`${v}-resize`,"important"),w.current.value=document.body.style.getPropertyValue("-webkit-user-select"),w.current.priority=document.body.style.getPropertyPriority("-webkit-user-select"),document.body.style.setProperty("-webkit-user-select","none","important"))},$=()=>{x!==null&&x.style.setProperty("cursor","text"),document.body!==null&&(document.body.style.setProperty("cursor","default"),document.body.style.setProperty("-webkit-user-select",w.current.value,w.current.priority))},h=(u,g)=>{var S,D,f;if(!a.isEditable())return;const b=(D=(S=e.current)==null?void 0:S.parentElement)==null?void 0:D.parentElement,c=(f=b==null?void 0:b.parentElement)==null?void 0:f.parentElement,v=l.current;if(b!=null&&v!==null&&c!==void 0&&c!==null){u.preventDefault();const{width:r,height:d}=b.getBoundingClientRect(),p=_.current;p.startWidth=r,p.startHeight=d,p.ratio=r/d,p.currentWidth=r,p.currentHeight=d,p.startX=u.clientX,p.startY=u.clientY,p.direction=g,s(g),a.update(()=>{const P=n.$getNodeByKey(t);Y(P)&&console.log(P.__height)}),v.classList.add("image-control-wrapper--resizing"),c.style.width=`${100*r/C}%`,document.addEventListener("pointermove",N),document.addEventListener("pointerup",R)}},N=u=>{var D,f;const g=e.current,b=(f=(D=e.current)==null?void 0:D.parentElement)==null?void 0:f.parentElement,c=_.current,v=c.direction&(o.east|o.west),S=c.direction&(o.south|o.north);if(g!==null&&b!==void 0&&b!==null)if(v&&S){let r=Math.floor(c.startX-u.clientX);r=c.direction&o.east?-r:r;const d=k(c.startWidth+r,y,C),p=d/c.ratio;b.style.width=`${100*d/C}%`,M(100*d/C),c.currentHeight=p,c.currentWidth=d}else if(S){let r=Math.floor(c.startY-u.clientY);r=c.direction&o.south?-r:r;const d=k(c.startHeight+r,z,E);c.currentHeight=d}else{let r=Math.floor(c.startX-u.clientX);r=c.direction&o.east?-r:r;const d=k(c.startWidth+r,y,C);g.style.width=`${100*d/C}%`,c.currentWidth=d}},R=()=>{var c,v;const u=(v=(c=e.current)==null?void 0:c.parentElement)==null?void 0:v.parentElement,g=_.current,b=l.current;u!==null&&b!==null&&(g.startWidth=0,g.startHeight=0,g.ratio=0,g.startX=0,g.startY=0,g.currentWidth=0,g.currentHeight=0,b.classList.remove("image-control-wrapper--resizing"),$(),document.removeEventListener("pointermove",N),document.removeEventListener("pointerup",R))};return m.useEffect(()=>{const u=_.current,g=e.current;if(g!=null){const{width:b}=g.getBoundingClientRect();u.currentWidth=b,M(100*b/C)}},[C,e]),i.jsxs(je,{ref:l,className:"ImageResizer",style:{width:`${L}%`},children:[i.jsx("div",{className:"image-resizer image-resizer-n",onPointerDown:u=>{h(u,o.north)}}),i.jsx("div",{className:"image-resizer image-resizer-ne",onPointerDown:u=>{h(u,o.north|o.east)}}),i.jsx("div",{className:"image-resizer image-resizer-e",onPointerDown:u=>{h(u,o.east)}}),i.jsx("div",{className:"image-resizer image-resizer-se",onPointerDown:u=>{h(u,o.south|o.east)}}),i.jsx("div",{className:"image-resizer image-resizer-s",onPointerDown:u=>{h(u,o.south)}}),i.jsx("div",{className:"image-resizer image-resizer-sw",onPointerDown:u=>{h(u,o.south|o.west)}}),i.jsx("div",{className:"image-resizer image-resizer-w",onPointerDown:u=>{h(u,o.west)}}),i.jsx("div",{className:"image-resizer image-resizer-nw",onPointerDown:u=>{h(u,o.north|o.west)}})]})}const je=fe.div`
  cursor: default;
  .image-resizer {
    display: block;
    width: 7px;
    height: 7px;
    position: absolute;
    background-color: rgb(60, 132, 244);
    border: 1px solid #fff;
  }

  .image-resizer.image-resizer-n {
    top: -6px;
    left: 48%;
    cursor: n-resize;
  }

  .image-resizer.image-resizer-ne {
    top: -6px;
    right: -6px;
    cursor: ne-resize;
  }

  .image-resizer.image-resizer-e {
    bottom: 48%;
    right: -6px;
    cursor: e-resize;
  }

  .image-resizer.image-resizer-se {
    bottom: -2px;
    right: -6px;
    cursor: nwse-resize;
  }

  .image-resizer.image-resizer-s {
    bottom: -2px;
    left: 48%;
    cursor: s-resize;
  }

  .image-resizer.image-resizer-sw {
    bottom: -2px;
    left: -6px;
    cursor: sw-resize;
  }

  .image-resizer.image-resizer-w {
    bottom: 48%;
    left: -6px;
    cursor: w-resize;
  }

  .image-resizer.image-resizer-nw {
    top: -6px;
    left: -6px;
    cursor: nw-resize;
  }
`;function ke({children:e,className:a}){return i.jsx("div",{className:a||"Placeholder__root",children:e})}const J=new Set,V=n.createCommand("RIGHT_CLICK_IMAGE_COMMAND");function Ye(e){if(!J.has(e))throw new Promise(a=>{const t=new Image;t.src=e,t.onload=()=>{J.add(e),a(null)}})}function Be({altText:e,className:a,imageRef:t,src:l}){return Ye(l),i.jsx("img",{className:a||void 0,src:l,alt:e,ref:t,draggable:"false"})}function Fe({src:e,altText:a,nodeKey:t,width:l,resizable:w,showCaption:_,caption:L,captionsEnabled:M}){const x=m.useRef(null),C=m.useRef(null),[E,y,z]=de.useLexicalNodeSelection(t),[s]=T.useLexicalComposerContext(),[$,h]=m.useState(null),N=m.useRef(null),R=m.useCallback(f=>{if(E&&n.$isNodeSelection(n.$getSelection())){f.preventDefault();const d=n.$getNodeByKey(t);Y(d)&&d.remove()}return!1},[E,t]),u=m.useCallback(f=>{const r=n.$getSelection(),d=C.current;if(E&&n.$isNodeSelection(r)&&r.getNodes().length===1){if(_)return n.$setSelection(null),f.preventDefault(),L.focus(),!0;if(d!==null&&d!==document.activeElement)return f.preventDefault(),d.focus(),!0}return!1},[L,E,_]),g=m.useCallback(f=>N.current===L||C.current===f.target?(n.$setSelection(null),s.update(()=>{y(!0);const r=s.getRootElement();r!==null&&r.focus()}),!0):!1,[L,s,y]),b=m.useCallback(f=>{const r=f;return r.target===x.current?(r.shiftKey?y(!E):(z(),y(!0)),!0):!1},[E,y,z]),c=m.useCallback(f=>{s.getEditorState().read(()=>{const r=n.$getSelection();f.target.tagName==="IMG"&&n.$isRangeSelection(r)&&r.getNodes().length===1&&s.dispatchCommand(V,f)})},[s]);m.useEffect(()=>{let f=!0;const r=s.getRootElement(),d=B.mergeRegister(s.registerUpdateListener(({editorState:p})=>{f&&p.read(()=>{const P=n.$getSelection();(n.$isNodeSelection(P)||n.$isRangeSelection(P))&&h(P)})}),s.registerCommand(n.SELECTION_CHANGE_COMMAND,(p,P)=>(N.current=P,!1),n.COMMAND_PRIORITY_LOW),s.registerCommand(n.CLICK_COMMAND,b,n.COMMAND_PRIORITY_LOW),s.registerCommand(V,b,n.COMMAND_PRIORITY_LOW),s.registerCommand(n.DRAGSTART_COMMAND,p=>p.target===x.current?(p.preventDefault(),!0):!1,n.COMMAND_PRIORITY_LOW),s.registerCommand(n.KEY_DELETE_COMMAND,R,n.COMMAND_PRIORITY_LOW),s.registerCommand(n.KEY_BACKSPACE_COMMAND,R,n.COMMAND_PRIORITY_LOW),s.registerCommand(n.KEY_ENTER_COMMAND,u,n.COMMAND_PRIORITY_LOW),s.registerCommand(n.KEY_ESCAPE_COMMAND,g,n.COMMAND_PRIORITY_LOW));return r==null||r.addEventListener("contextmenu",c),()=>{f=!1,d(),r==null||r.removeEventListener("contextmenu",c)}},[z,s,E,t,R,u,g,b,c,y]);const v=()=>{s.update(()=>{const f=n.$getNodeByKey(t);Y(f)&&f.setShowCaption(!0)})},S=E&&n.$isNodeSelection($),D=E;return i.jsx(m.Suspense,{fallback:null,children:i.jsxs(i.Fragment,{children:[i.jsx("div",{draggable:S,children:i.jsx(Be,{className:D?`focused ${n.$isNodeSelection($)?"draggable":""}`:null,src:e,altText:a,imageRef:x,width:l})}),_&&i.jsx("div",{className:"image-caption-container",children:i.jsxs(Ae.LexicalNestedComposer,{initialEditor:L,children:[i.jsx(le.AutoFocusPlugin,{}),i.jsx(Pe.HashtagPlugin,{}),i.jsx(be.RichTextPlugin,{contentEditable:i.jsx(He,{className:"ImageNode__contentEditable"}),placeholder:i.jsx(ke,{className:"ImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:ge})]})}),w&&n.$isNodeSelection($)&&D&&i.jsx(We,{showCaption:_,setShowCaption:v,editor:s,buttonRef:C,imageRef:x,nodeKey:t,captionsEnabled:M})]})})}export{V as RIGHT_CLICK_IMAGE_COMMAND,Fe as default};
